@{
    ViewBag.Title = "مثال";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<div class="modal fade" id="conceptModal" role="dialog">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal">&times;</button>
                <h4 class="modal-title">مثال</h4>
            </div>
            <div class="modal-body">
                
                <form name="conceptForm" novalidate>
                    <div class="content">

                        <div class="row form-group" ng-class="{'has-error': conceptForm.name.$error.required}" >
                            <label class="control-label" for="conceptName">الاسم</label>
                            <span class="required" ng-show="conceptForm.name.$error.required">
                                الرجاء ادخال الاسم
                            </span>
                            <input name="name" class="form-control" id="conceptName" ng-model="concept.Name" required/>
                        </div>

                        <div class="row form-group" ng-class="{'has-error': conceptForm.value.$error.required}">
                            <label class="control-label" for="conceptValue">القيمة</label>
                            <span class="required" ng-show="conceptForm.value.$error.required">
                                الرجاء ادخال القيمة
                            </span>
                            <input name="value" type="number" class="form-control" id="conceptValue" ng-model="concept.Value" required/>
                        </div>

                    </div>
                </form>

            </div>
            <div class="modal-footer">
                <button id="btnUpload" type="button" class="btn btn-default" data-dismiss="modal">اغلق</button>
                <button type="button" class="btn btn-success" @*ng-disabled="conceptForm.$invalid"*@ ng-click="save()">حفظ</button>
            </div>
        </div>
    </div>
</div>



<div class="row">

    <div class="col-md-6">
        <button class="btn btn-success" data-toggle="modal" ng-click="new()" > جديد </button>
    </div>

    <div class="col-md-6">
        <h2>مثال</h2>
    </div>
</div>




<div class="box row">
    <div class="box-header">
        @*<h3 class="box-title">Table Header</h3>*@
    </div>
    <div class="box-body">
        <table datatable="ng" class="table table-bordered table-striped table-hover">
            <thead>
            <tr>
                <th>الرقم</th>
                <th>الاسم</th>
                <th>القيمة</th>
                <th width="200px"></th>
            </tr>
            </thead>

            <tbody id="tableBody">
            <tr ng-repeat="x in concepts">
                <td ng-bind="x.Id"></td>
                <td ng-bind="x.Name"></td>
                <td ng-bind="x.Value"></td>
                <td>
                    <Button type="button" class="btn btn-success btn-xs" ng-click="edit(x)">تعديل</Button>
                    <Button type="button" class="btn btn-default btn-xs" ng-click="edit(x)">التفاصيل</Button>
                    <Button type="button" class="btn btn-danger btn-xs" ng-click="delete(x)">حذف</Button>
                </td>
            </tr>
            </tbody>

        </table>
    </div>
</div>


@section scripts
{

    <script>
        var parking = angular.module("CarWorkshop", []);

        parking.controller("CarWorkshopController", function($scope) {

            var conceptModal = $("#conceptModal");

            //btnUpload
            $("#btnUpload").click(function () {
                var files = $("#file1").get(0).files;
                if (files.length > 0) {
                    var data = new FormData();
                    for (i = 0; i < files.length; i++) {
                        data.append("file" + i, files[i]);
                    }
                    $.ajax({
                        type: "POST",
                        url: "http:////" + window.location.host + "/Api/ApiConcept/Post",
                        contentType: false,
                        processData: false,
                        data: data,
                        success: function(results) {
                            for (i = 0; i < results.length; i++) {
                                alert(results[i]);
                            }
                        }
                    });
                }
            });


            var getData = function(url, successs) {
                $.ajax({
                    url: url,
                    type: 'GET',
                    dataType: 'json',
                    success: function(data) {
                        successs(data);
                        $scope.$apply();
                    },
                    error: function(x, y, z) {
                        alert("ERROR:" + x + '\n' + y + '\n' + z);
                    }
                });
            };

            var url = "http:////" + window.location.host + "/Api/ApiConcept/";

            $(document).ready(function() {
                $scope.getList();

            });

            $scope.getList = function() {
                getData(url + "get", function(data) {
                    $scope.concepts = data;
                });
            };

            $scope.new = function() {
                $scope.concept = null;
                conceptModal.modal('show');
            };

            $scope.edit = function(concept) {
                $scope.concept = concept;
                conceptModal.modal('show');
            };

            $scope.save = function() {
                if (!$scope.conceptForm.$valid) {
                    alert("Opps please fix form problems first");
                    return;
                }

                $.ajax({
                    url: "http:////" + window.location.host + "/Api/ApiConcept/Post",
                    type: 'POST',
                    dataType: 'json',
                    data: $scope.concept,
                    success: function(data) {
                        conceptModal.modal('hide');
                        $scope.getList();
                    },
                    error: function(x, y, z) {
                        alert("ERROR:" + x + '\n' + y + '\n' + z);
                    }
                });
            };

            $scope.delete = function(concept) {

                $.ajax({
                    url: "http:////" + window.location.host + "/Api/ApiConcept/Delete/" + concept.Id,
                    type: 'DELETE',
                    dataType: 'json',
                    success: function(data) {
                        $scope.getList();
                    },
                    error: function(x, y, z) {
                        alert("ERROR:" + x + '\n' + y + '\n' + z);
                    }
                });

            };


        });

    </script>
}